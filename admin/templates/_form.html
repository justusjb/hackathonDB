<div class="container">
    <form>

        <label for="name">Hackathon Name:</label>
        <input type="text" id="name" name="name" autocomplete="off">

        <label for="date-range">Date Range:</label>
        <input type="text" id="date-range" name="date-range" autocomplete="off">

        <label for="city">City:</label>
        <input type="text" id="city" name="city" autocomplete="off">

        <label for="url">URL:</label>
        <input type="text" id="url" name="url" autocomplete="off">

        <label for="notes">Notes:</label>
        <input type="text" id="notes" name="notes" autocomplete="off">


        <label>Status:</label>
            <div class="status-buttons">
                <input type="radio" id="announced" name="status" value="announced">
                <label for="announced">Announced</label>

                <input type="radio" id="applications_open" name="status" value="applications_open">
                <label for="applications_open">Applications Open</label>

                <input type="radio" id="applications_closed" name="status" value="applications_closed">
                <label for="applications_closed">Applications Closed</label>

                <input type="radio" id="expected" name="status" value="expected">
                <label for="expected">Expected</label>

            </div>

        <input type="submit" value="Submit">
    </form>
    <div id="message"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        initializeFlatpickr();
    
        async function submitForm(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const formDataJSON = Object.fromEntries(formData.entries());
    
            const response = await fetch('/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formDataJSON)
            });
    
            const result = await response.json();
            const messageDiv = document.getElementById('message');
            if (response.ok) {
                messageDiv.innerHTML = '<p class="success">' + result.message + '</p>';
                event.target.reset();
                initializeFlatpickr(); // Reinitialize Flatpickr after form reset
            } else {
                messageDiv.innerHTML = '<p class="error">' + result.detail + '</p>';
            }
        }
    
        const form = document.querySelector('form');
        form.addEventListener('submit', submitForm);
    });
    
    function initializeFlatpickr() {
        const dateInput = document.getElementById('date-range');
        let flatpickrInstance;
    
        function calculateMonthDifference(selectedDateString, currentYear, currentMonth) {
            const selectedDate = new Date(selectedDateString);
            const selectedYear = selectedDate.getFullYear();
            const selectedMonth = selectedDate.getMonth();
            const yearDifference = selectedYear - currentYear;
            const monthDifference = selectedMonth - currentMonth;
            return yearDifference * 12 + monthDifference;
        }
    
        function initializeMonthPicker() {
            flatpickrInstance = flatpickr(dateInput, {
                plugins: [new monthSelectPlugin({
                    shorthand: true,
                    dateFormat: "Y-m",
                    altFormat: "F Y",
                    theme: "light",
                })],
                onChange: function (selectedDates, dateStr, instance) {
                    if (selectedDates.length > 0) {
                        const selectedMonth = selectedDates[0];
                        switchToDateRangePicker(selectedMonth);
                    }
                }
            });
        }
    
        function switchToDateRangePicker(selectedMonth) {
            if (flatpickrInstance) {
                flatpickrInstance.destroy(); // Destroy the existing instance
            }
    
            flatpickrInstance = flatpickr(dateInput, {
                mode: 'range',
                dateFormat: 'Y-m-d',
                minDate: 'today',
                defaultDate: null,
                locale: {
                    firstDayOfWeek: 1
                },
                onReady: function(fp) {
                    if (fp && fp.config) {
                        fp.config.closeOnSelect = false; // Ensure the option is set after initialization
                    }
                }
            });
    
            flatpickrInstance.open();
            flatpickrInstance.changeMonth(calculateMonthDifference(selectedMonth, flatpickrInstance.currentYear, flatpickrInstance.currentMonth));
            flatpickrInstance.clear();
        }
    
        initializeMonthPicker(); // Initialize the month picker when the DOM is ready
    }
</script>